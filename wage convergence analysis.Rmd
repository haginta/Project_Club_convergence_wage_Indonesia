---
title: "Convergence Clubs of wage in 34 Indonesian Provinces"
output: html_notebook
---

#Activate necessary libraries
```{r}
library(ConvergenceClubs)
library(tidyverse)
library(janitor)
library(tibble)
```


#Part I: Nominal Wage using definition "A" of worker
#Load the data
```{r}
library(readxl)
nominal.wage <- read_excel("WS Labour_new.xlsx", 
    sheet = "nominal_wage_A")
nominal.wage
```

#Select data only from 2008 onwards and remove "Region" column, and remove the observation of Indonesia
```{r}
nominal.wage <- nominal.wage %>% 
  select(-c(1,3:5)) %>% 
  subset(Province!="National")
```

#transform the wage series to log
```{r}
nominal.wage.log <- log(nominal.wage[,-1])
nominal.wage.log
```

#Remove short-run noise using HP filter
```{r}
f.nominal.wage.log <- apply(nominal.wage.log, 1, 
function(x){mFilter::hpfilter(x, freq=6.25, type="lambda")$trend} ) 
f.nominal.wage.log <- data.frame(Province = nominal.wage[,1], t(f.nominal.wage.log), stringsAsFactors=FALSE ) 
colnames(f.nominal.wage.log) <- colnames(nominal.wage) 
```

#Inspect the filtered data
```{r}
head(f.nominal.wage.log)
```

#Run the log-t-test
```{r}
H.nominal <- computeH(f.nominal.wage.log[,-1], quantity = "H")
round(estimateMod(H.nominal, time_trim=0.333, HACmethod = "FQSB"), 3)
```

#find convergence clubs
```{r}
clubs.nominal <- findClubs(f.nominal.wage.log, dataCols=2:14, unit_names = 1, refCol=14,
time_trim=0.333, cstar=0, HACmethod = 'FQSB')
```

```{r}
summary(clubs.nominal)
```

```{r}
print(clubs.nominal)
```

```{r}
plot(clubs.nominal)
```

```{r}
plot(clubs.nominal, clubs=NULL, avgTP = TRUE, legend=TRUE)
```

#Merge clubs
```{r}
mclubs.nominal <- mergeClubs(clubs.nominal, mergeMethod='PS')
summary(mclubs.nominal)
```

```{r}
mclubs.nominal
```

```{r}
plot(mclubs.nominal)
```

```{r}
plot(mclubs.nominal, clubs=NULL, avgTP = TRUE, legend=TRUE)
```

--------------
#Part II: Real Wage using definition "A" of worker
#Load the data
```{r}
library(readxl)
real.wage <- read_excel("WS Labour_new.xlsx", 
    sheet = "real_wage_A")
real.wage
```

#Select data only from 2008 onwards and remove "Region" column, and remove the observation of Indonesia
```{r}
real.wage <- real.wage %>% 
  select(-c(1,3:5)) %>% 
  subset(Province!="National")
```

#transform the wage series to log
```{r}
real.wage.log <- log(real.wage[,-1])
real.wage.log
```

#Remove short-run noise using HP filter
```{r}
f.real.wage.log <- apply(real.wage.log, 1, 
function(x){mFilter::hpfilter(x, freq=6.25, type="lambda")$trend} ) 
f.real.wage.log <- data.frame(Province = real.wage[,1], t(f.real.wage.log), stringsAsFactors=FALSE ) 
colnames(f.real.wage.log) <- colnames(real.wage) 
```

#Inspect the filtered data
```{r}
head(f.real.wage.log)
```

#Run the log-t-test
```{r}
H.real <- computeH(f.real.wage.log[,-1], quantity = "H")
round(estimateMod(H.real, time_trim=0.333, HACmethod = "FQSB"), 3)
```

#find convergence clubs
```{r}
clubs.real <- findClubs(f.real.wage.log, dataCols=2:14, unit_names = 1, refCol=14,
time_trim=0.333, cstar=0, HACmethod = 'FQSB')
```

```{r}
summary(clubs.real)
```

```{r}
print(clubs.real)
```

```{r}
plot(clubs.real)
```

```{r}
plot(clubs.real, clubs=NULL, avgTP = TRUE, legend=TRUE)
```

#Merge clubs
```{r}
mclubs.real <- mergeClubs(clubs.real, mergeMethod='PS')
summary(mclubs.real)
```

```{r}
mclubs.real
```

```{r}
plot(mclubs.real)
```

```{r}
plot(mclubs.real, clubs=NULL, avgTP = TRUE, legend=TRUE)
```


